<nz-layout class="px-3">
    <nz-card class="w-100" nzTitle="Campaign Performance Overview" [nzExtra]="dateTemplate">
        <h5 nz-typography class="d-flex align-items-center mb-3">
            <span nz-icon nzType="facebook" nzTheme="fill" class="me-2"></span>
            Facebook
        </h5>
        <nz-table #facebookTable nzBordered [nzFooter]="facebookSummaryFooter" [nzData]="metaMapData"
            nzTableLayout="fixed" [nzShowPagination]="false">
            <thead>
                <tr>
                    <th width="350px">Campaign</th>
                    <th width="150px">Mục tiêu</th>
                    <th width="110px">Đã chi tiêu</th>
                    <th width="110px">Kết quả</th>
                    <th width="150px">Chi phí / Kết quả</th>
                    <th width="90px">CPM</th>
                    <th width="90px">CTR</th>
                    <th width="90px">Tin nhắn</th>
                    <th>Chi phí tin nhắn</th>
                    <th>Tần suất</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of facebookTable.data">
                    <ng-container *ngFor="let item of metaExpandedData[data.key]">
                        <tr *ngIf="(item.parent && item.parent.expand) || !item.parent">
                            <td [nzIndentSize]="item.level! * 20" [nzShowExpand]="!!item.children"
                                [(nzExpand)]="item.expand"
                                (nzExpandChange)="collapse(metaExpandedData[data.key], item, $event)" nzEllipsis
                                nzEllipsisRows="1">
                                {{ item.name }}
                            </td>
                            <td nzEllipsis nzEllipsisRows="1">{{ item.objective }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.impressions | thousandSeparator }}</td>
                            <td>{{ item.cpc | thousandSeparator }}</td>
                            <td>{{ item.reach | thousandSeparator }}</td>
                            <td>{{ item.ctr | thousandSeparator }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.frequency | thousandSeparator }}</td>
                        </tr>
                    </ng-container>
                </ng-container>
            </tbody>
        </nz-table>

        <ng-template #facebookSummaryFooter>
            <span class="d-flex justify-content-end">
                Tổng cộng:
                <b class="ms-2 me-1 text-success">{{ totalMetaAdsSpend | thousandSeparator }}</b>
                (đã bao gồm 10% thuế)
            </span>
        </ng-template>

        <h5 nz-typography class="mt-5 d-flex align-items-center mb-3">
            <span nz-icon nzType="instagram" nzTheme="fill" class="me-2"></span>
            Instagram
        </h5>
        <nz-table #instagramTable nzBordered [nzFooter]="instagramSummaryFooter" [nzData]="instaMapData"
            nzTableLayout="fixed" [nzShowPagination]="false">
            <thead>
                <tr>
                    <th width="350px">Campaign</th>
                    <th width="150px">Mục tiêu</th>
                    <th width="110px">Đã chi tiêu</th>
                    <th width="110px">Kết quả</th>
                    <th width="150px">Chi phí / Kết quả</th>
                    <th width="100px">CPM</th>
                    <th width="100px">CTR</th>
                    <th width="90px">Tin nhắn</th>
                    <th>Chi phí tin nhắn</th>
                    <th>Tần suất</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of instagramTable.data">
                    <ng-container *ngFor="let item of instaExpandedData[data.key]">
                        <tr *ngIf="(item.parent && item.parent.expand) || !item.parent">
                            <td [nzIndentSize]="item.level! * 20" [nzShowExpand]="!!item.children"
                                [(nzExpand)]="item.expand"
                                (nzExpandChange)="collapse(instaExpandedData[data.key], item, $event)">
                                {{ item.name }}
                            </td>
                            <td nzEllipsis nzEllipsisRows="1">{{ item.objective }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.impressions | thousandSeparator }}</td>
                            <td>{{ item.cpc | thousandSeparator }}</td>
                            <td>{{ item.reach | thousandSeparator }}</td>
                            <td>{{ item.ctr | thousandSeparator }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.spend | thousandSeparator }}</td>
                            <td>{{ item.frequency | thousandSeparator }}</td>
                        </tr>
                    </ng-container>
                </ng-container>
            </tbody>
        </nz-table>

        <ng-template #instagramSummaryFooter>
            <span class="d-flex justify-content-end">
                Tổng cộng:
                <b class="ms-2 me-1 text-success">{{ totalInstagramAdsSpend | thousandSeparator }}</b>
                (đã bao gồm 10% thuế)
            </span>
        </ng-template>
    </nz-card>
    <ng-template #dateTemplate>
        <nz-space>
            <nz-range-picker *nzSpaceItem nzMode="date" [nzPlaceHolder]="['Ngày bắt đầu', 'Ngày kết thúc']"
                [nzRanges]="ranges" [(ngModel)]="selectedRange" (ngModelChange)="onChange($event)">
            </nz-range-picker>
        </nz-space>
    </ng-template>
</nz-layout>